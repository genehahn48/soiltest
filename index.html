<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soil test map</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
    <link rel="stylesheet" href="css/style.css" />

  </head>
  <style>
  </style>

  <body>

    <header>
      <h1>Soil Test Map</h1>
      <h2>subheading here</h2>
    </header>
    <div class="grid-container">

      <div class="map-1">
        <div id="map-01"></div>
      </div>
      <div class="map-2">
        <div id="map-02" class="yellow">Map #2</div>
      </div>
      <div class="map-3 blue">
        <div id="map-03" class="blue">Map #3</div>
      </div>
      <div class="map-4 green">
        <div id="map-04" class="green">Map #4</div>
      </div>
    </div>
    <footer>
      <p>Map authored by Gene</p>
      <p>More information here ...</p>
    </footer>

    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.0.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
    <script>
      const map01 = L.map('map-01').setView([37.62, -85.20], 7);

      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 19
      }).addTo(map01);

      // request all your desired datasets first
      const countiesJson = d3.json('project-data/ky-farm-ac.geojson');
      const regionsJson = d3.json('project-data/ky-regions.json');
      const alfalfaLevel = d3.csv('project-data/alfalfa_levels.csv');
      const canolaLevel = d3.csv('project-data/canola_levels.csv');
      const coolseasonLevel = d3.csv('project-data/coolseason_levels.csv');
      const cornLevel = d3.csv('project-data/corn_levels.csv');
      const smallgrainsLevel = d3.csv('project-data/smallgrains_levels.csv');
      const sorghumLevel = d3.csv('project-data/sorghum_levels.csv');
      const soyLevel = d3.csv('project-data/soy_levels.csv');
      const tobaccoLevel = d3.csv('project-data/tobacco_levels.csv');
      const warmseasonLevel = d3.csv('project-data/warmseason_levels.csv');
      // Load median values for all categories
      const alfalfaMedCsv = d3.csv('project-data/alfalfa_median.csv');
      const canolaMedCSV = d3.csv('project-data/canola_median.csv');
      const coolseasonMedCSV = d3.csv('project-data/coolseason_median.csv');
      const cornMedCSV = d3.csv('project-data/corn_median.csv');
      const smallgrainsMedCSV = d3.csv('project-data/smallgrains_median.csv');
      const sorghumMedCSV = d3.csv('project-data/sorghum_median.csv');
      const soyMedCSV = d3.csv('project-data/soy_median.csv');
      const tobaccoMedCSV = d3.csv('project-data/tobacco_median.csv');
      const warmseasonMedCSV = d3.csv('project-data/warmseason_median.csv');

      // wait until they are ready and then send to dataReady function
      Promise.all([countiesJson, regionsJson, cornMedCSV, alfalfaLevel, canolaLevel, coolseasonLevel, cornLevel, smallgrainsLevel, sorghumLevel, soyLevel, tobaccoLevel, warmseasonLevel, alfalfaMedCsv, canolaMedCSV, coolseasonMedCSV,
        smallgrainsMedCSV, sorghumMedCSV, tobaccoMedCSV, warmseasonMedCSV
      ]).then(dataReady, error);

      // function fired if there is an error
      function error(error) {
        console.log(error)
      }

      // Global variables
      const cropType = ["Alfalfa", "Canola", "Cool Season Grass", "Corn", "Small Grains", "Sorghum", "Soybean", "Tobacco", "Warm Season Grass"];

      const loCroptype = ["alfalfa", "canola", "coolseason", "corn", "smallgrains", "sorghum", "soy", "tobacco", "warmseason"];

      const selYear = [1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019];

      const selNutrient = ["Phosphorus", "Potassium"];

      const MedData = ["cornMedData", "alfalfaMedData", "canolaMedData", "coolseasonMedData", "smallgrainsMedData", "sorghumMedData", "tobaccoMedData", "warmseasonMedData"];

      // try to build funtion to link data to geojson
      loCroptype.forEach(function(crop, i) {
        console.log(i + 3 + " Crop : " + crop)
      });

      selYear.forEach(display);

      function display(year, index) {
        console.log(index + 8 + " Year: " + year)
      };

      function dataReady(data) {
        // console.log(cropType, selYear)
        // reference the counties GeoJSON data
        const countiesJson = data[0];

        // reference the data set, the CSV
        const cornMedData = data[2];
        const alfalfa = data[3];
        const canola = data[4];
        const coolseason = data[5];
        const corn = data[6];
        const smallgrains = data[7];
        const sorghum = data[8];
        const soy = data[9];
        const tobacco = data[10];
        const warmseason = data[11];
        const alfalfaMedData = data[12];
        const canolaMedData = data[13];
        const coolseasonMedData = data[14];
        const smallgrainsMedData = data[15];
        const sorghumMedData = data[16];
        const tobaccoMedData = data[17];
        const warmseasonMedData = data[18];

        // here we want to bind CSV data to the county GeoJSON
        console.log(MedData)
        // loop through the county features
        countiesJson.features.forEach(function(feature) {

          // loop through corn median CSV data

          cornMedData.forEach(function(row, i) {
            // if the county name and CSV name match
            if (row.COUNTY == feature.properties.name) {

              // create a new property for the corn mean and assign the data
              feature.properties['corn_med'] = row;
            }
          })
        })

        // double check that the bind was successful
        console.log()
        console.log(data[0])
        // console.log(data[6])


        // draw geojson to the map
        L.geoJson(data[0]).addTo(map01);
        // Add selection dropdown
        // addCroptype(cropType);
        // addSelyear(selYear);
      }
      // Create loop to bind data
      // countiesJson.features.forEach(function(feature) {
      //
      //   // loop through corn median CSV data
      //   MedData.forEach(function(name, i) {
      //     name[i].forEach(function(row, i) {
      //       console.log(row)
      //       // if the county name and CSV name match
      //       if (row.COUNTY == feature.properties.name) {
      //
      //         // create a new property for the corn mean and assign the data
      //         feature.properties[name[i]] = row;
      //       }
      //     })
      //   })
      // });
    </script>
  </body>

</html>
