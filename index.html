<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soil test map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <style>
  </style>

  <body>

    <header>
      <h1>Soil Test Data Single Crop Map</h1>
      <h2>Select year, nutrient, and crop type.</h2>
    </header>
    <div class="grid-container">

      <div class="map-1">
        <form name = "map01">
          <label for="yearMap1">Year</label>
          <input type="range" min=1990 max=2019 step=1 id="yearMap1" value=2010
          oninput="selected_yearMap1.value = yearVal(this.value)">
          <output name="selected_yearMap1" id="selected_year1">2010</output>
<!-- chemical selection radio button map01 -->
            <input type="radio" id="p" name="chemMap01" onclick="nutVal(this.value)" value="P" checked>
              <label for="P">Phosphorus</label>
          <input type="radio" id="k" name="chemMap01"  onclick="nutVal(this.value)" value="K">
            <label for="K">Potassium</label>
            <div class="filterCrop">
          </div>
        </form>
        <div id="legend"></div>
        <div id="map-01"></div>
      </div>

      <div class="map-2">
        <div id="map-02" class="yellow">Map #2</div>
      </div>
      <div class="map-3 blue">
        <div id="map-03" class="blue">Map #3</div>
      </div>
      <div class="map-4 green">
        <div id="map-04" class="green">Map #4</div>
      </div>
    </div>
    <footer>
      <p>Map authored by Gene</p>
      <p>More information here ...</p>
    </footer>

    <!-- load D3 library -->
      <script src="https://d3js.org/d3.v6.min.js"></script>
      <!-- load D3 color  -->
        <script src="https://d3js.org/d3-color.v1.min.js"></script>
      <!-- load jQuery library -->
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
    crossorigin="anonymous"></script>
     <!-- load TopoJSON -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
        <!-- load global variables from variables.js files -->
      <script type="text/javascript" src="/js/variables.js"></script>
      <script>

        const map01 = L.map('map-01').setView([37.8, -85.65], 7);
        L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
        subdomains:['mt0','mt1','mt2','mt3'],
        maxZoom: 10, // set maxZoom to county level
        minZoom: 6,    // set minZoom to State of Kentucky
      }).addTo(map01);



        // wait until they are ready and then send to dataReady function
        Promise.all([countiesJson,regionsJson,alfalfaLevel,canolaLevel,coolseasonLevel,cornLevel,
                      smallgrainsLevel,sorghumLevel,soyLevel,tobaccoLevel,
                      warmseasonLevel,alfalfaMedCsv,canolaMedCSV,coolseasonMedCSV,
                      cornMedCSV,smallgrainsMedCSV,sorghumMedCSV,soyMedCSV,tobaccoMedCSV,warmseasonMedCSV
        ]).then(dataReady, error);

        // function fired if there is an error
        function error(error) {
          console.log(error)
        }
  // load data with dataReady function
    function dataReady(data) {
  // reference the counties GeoJSON data
          const countiesJson = data[0];
          const regionsJson = data[1];
  // reference the data set, the CSV
          const alfalfa = data[2];
          const canola = data[3];
          const coolseason = data[4];
          const corn = data[5];
          const smallgrains = data[6];
          const sorghum = data[7];
          const soy = data[8];
          const tobacco = data[9];
          const warmseason = data[10];
          const alfalfaMedData = data[11];
          const canolaMedData = data[12];
          const coolseasonMedData = data[13];
          const cornMedData = data[14];
          const smallgrainsMedData = data[15];
          const sorghumMedData = data[16];
          const tobaccoMedData = data[17];
          const warmseasonMedData = data[18];
  // here we want to bind CSV data to the county GeoJSON
  // create variable bindData to loop all csv files in leaflet bind features to json
        const bindData = [alfalfa, canola, coolseason, corn, smallgrains, sorghum, soy, tobacco, warmseason,
                        alfalfaMedData, canolaMedData, coolseasonMedData, cornMedData,smallgrainsMedData,
                        sorghumMedData, tobaccoMedData, warmseasonMedData];
  // create variable to name loop data bind to GeoJSON
        const bindName = loCroptype;
        MedData.forEach(function(x){
          bindName.push(x)
        })

  // loop bindData and send bindName to name crops
      bindData.forEach(function(bindData,x){
  // loop through the county features
      countiesJson.features.forEach(function(feature) {
            bindData.forEach(function(row, i) {
        // if the county name and CSV name match
        if (row.COUNTY == feature.properties.name) {

          // create a new property for the csv data in the json and assign the data
          feature.properties[bindName[x]] = row;
        }
      })
    })
  });
  // double check that the bind was successful
      console.log(data[0],"county data");
      console.log(data[1],"region");
      console.log(countiesJson);
      console.log(regionsJson);
      console.log(nutValmap1 +" : Map1");
      console.log(yearValMap1);

    // draw geojson to the map
          L.geoJson(data[0]).addTo(map01);
          L.geoJson(data[1]).addTo(map01);
          // Add selection dropdown
          // addCroptype(cropType);
          // addSelyear(selYear);

    };

    function nutVal (n){
          console.log(n+": map1")
          nutValmap1=n
          return nutValmap1
        };
        function yearVal (n){
              console.log(n+": map1 year")
              yearValMap1 = n
              return yearValMap1
            };


      </script>
    </body>

  </html>
